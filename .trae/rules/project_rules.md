# 项目规则 (project_rules.md)

> 本文件定义Agent角色、工作流程和协作规范。Agent不会自动阅读，需在描述中明确要求。

---

## 一、Agent角色定义（7个）

| # | 角色 | 职责 | 核心文件 |
|---|------|------|----------|
| 1 | 项目经理 | 整体协调、任务分配、进度跟踪 | `.trae/share/` |
| 2 | 团队协作员 | 团队协作管理、优化建议 | `.trae/rules/`, `.trae/agents/` |
| 3 | 算法工程师 | PPO优化、超参数调优 | `algorithms/`, `train_ppo.py` |
| 4 | 环境工程师 | 环境建模、奖励函数、物理仿真 | `envs/` |
| 5 | 可视化工程师 | 训练可视化、调试工具 | `visualize.py` |
| 6 | 质量分析师 | 发现问题、诊断日志设计 | 全项目 |
| 7 | 文档工程师 | 文档维护、API文档 | `README.md` |

---

## 二、触发信号规则

当用户在Agent窗口说"1"时，该Agent应：

1. **读取项目规则**：首先阅读本文件
2. **识别自身角色**：根据窗口描述或上下文确定
3. **检查待领取任务**：读取 `share/tasks/pending.md`
4. **领取并执行**：找到属于自己的任务，开始工作
5. **汇报结果**：写入 `share/reports/{role}/`

---

## 三、工作流程

```
用户 ──沟通──> 项目经理Agent ──发布任务──> share/tasks/pending.md
                                              │
用户 ──"1"──> 专业Agent ──领取任务──> share/tasks/in_progress.md
                    │
                    └──完成工作──> share/reports/{role}/
                                    │
项目经理Agent ──审核──> share/tasks/completed.md
```

**任务状态流转**：`pending.md(待领取) → in_progress.md(进行中) → completed.md(已完成)`

---

## 四、任务状态管理规范

### 4.1 任务领取标准操作流程
1. **读取任务**：专业Agent读取 `share/tasks/pending.md` 中的任务
2. **确认资格**：确认任务分配给自己的角色
3. **检查依赖**：检查任务是否有依赖，确保依赖任务已完成或正在进行
4. **移除任务**：领取任务后，立即从 `pending.md` 中移除该任务
5. **添加任务**：将任务添加到 `share/tasks/in_progress.md` 中，设置状态为"进行中"
6. **记录时间**：在 `in_progress.md` 中记录开始时间
7. **通知相关**：通知项目经理和相关Agent任务已被领取

### 4.2 任务完成标准操作流程
1. **完成工作**：专业Agent完成任务工作
2. **生成报告**：在 `share/reports/{role}/` 中生成工作报告
3. **更新状态**：将任务状态从"进行中"更新为"已完成"
4. **移除任务**：从 `in_progress.md` 中移除该任务
5. **添加任务**：将任务添加到 `share/tasks/completed.md` 中
6. **记录信息**：在 `completed.md` 中记录完成时间和报告位置
7. **通知相关**：通知项目经理和相关Agent任务已完成
8. **检查依赖**：检查是否有依赖于该任务的其他任务，如有，通知相关Agent

### 4.3 任务状态验证机制
1. **定期核对**：项目经理每日至少核对一次三个任务状态文件的一致性
2. **唯一性检查**：确保每个任务ID在系统中唯一存在于一个状态文件中
3. **状态变更通知**：所有任务状态变更时，通知相关Agent
4. **异常处理**：发现任务状态不一致时，立即报告项目经理协调解决
5. **审计机制**：定期对任务状态变更进行审计，确保流程合规

### 4.4 任务状态管理工具
1. **状态可视化**：实时更新 `share/status.md` 中的任务统计信息
2. **过期提醒**：对超过24小时未完成的任务发出提醒，超过48小时的任务升级为警告
3. **状态变更日志**：详细记录所有任务状态变更，包括变更时间、变更人、变更原因
4. **依赖任务监控**：实时监控依赖任务的完成状态，确保依赖任务优先完成
5. **任务状态仪表板**：建立任务状态可视化仪表板，直观展示任务分布和状态

### 4.5 任务状态流转规范
1. **状态定义**：
   - 待领取（pending）：任务已发布，等待专业Agent领取
   - 进行中（in_progress）：任务已被领取，正在执行
   - 等待依赖（waiting）：任务已被领取，但依赖任务未完成
   - 需要帮助（blocked）：任务执行过程中遇到问题，需要帮助
   - 已完成（completed）：任务已完成，等待项目经理审核

2. **状态变更条件**：
   - 待领取 → 进行中：专业Agent确认领取任务
   - 进行中 → 等待依赖：发现依赖任务未完成
   - 等待依赖 → 进行中：依赖任务已完成
   - 进行中 → 需要帮助：任务执行遇到无法自行解决的问题
   - 需要帮助 → 进行中：问题已解决
   - 进行中 → 已完成：任务工作已完成，生成工作报告

3. **状态变更权限**：
   - 只有任务负责人可以更新任务状态
   - 项目经理可以强制更新任何任务状态
   - 团队协作员可以建议任务状态更新，但不能直接修改

---

## 五、文件读写规范

### 任务文件格式

**pending.md**：
```markdown
## 任务#1
- **标题**: xxx
- **描述**: xxx
- **分配给**: [角色名称]
- **依赖**: [任务#N 或 无]
- **优先级**: 高/中/低
- **创建时间**: YYYY-MM-DD HH:MM
```

**in_progress.md**：
```markdown
## 任务#1
- **标题**: xxx
- **负责人**: [角色名称]
- **开始时间**: YYYY-MM-DD HH:MM
- **状态**: 进行中/等待依赖/需要帮助
```

**completed.md**：
```markdown
## 任务#1
- **标题**: xxx
- **完成人**: [角色名称]
- **完成时间**: YYYY-MM-DD HH:MM
- **报告位置**: share/reports/{role}/xxx.md
```

### 报告文件格式

```markdown
# 工作报告 - [日期]

## 完成的任务
- 任务#1: xxx

## 工作内容
- 详细描述做了什么

## 遇到的问题
- 问题1: xxx（已解决/未解决）

## 建议/后续工作
- 建议1: xxx
```

---

## 五、冲突避免机制

### 任务分配规则
- 每个任务必须指定 `assigned_role`
- 只有对应角色的Agent才能领取任务
- 如果任务涉及多个角色，项目经理应拆分任务

### 文件修改规则
- 修改代码前，先检查是否有其他Agent正在修改同一文件
- 如果发现冲突，在报告中说明并请求项目经理协调

### 依赖任务处理
- 任务标注 `depends_on` 时，Agent必须先检查依赖任务是否完成
- 如果依赖未完成，在 `in_progress.md` 中标注状态为"等待依赖"

---

## 六、项目经理双线程工作模式

### 主线程（用户任务）
1. 接收用户指令
2. 分析需求
3. 发布任务或回答问题
4. 更新相关文件

### 检查线程（自动执行）
1. 读取 `share/status.md`
2. 检查：过期任务(>24h)、未完成任务、待确认决策
3. 如发现问题，向用户报告

---

## 七、团队协作员工作模式

1. **读取团队状态**：检查所有Agent的工作报告和share目录
2. **分析协作问题**：任务分配、Agent冲突、工作负荷、规则完善
3. **生成建议报告**：写入 `share/team/coordinator.md`

---


*本规则文件由团队协作员Agent维护，如有改进建议请联系团队协作员。*
